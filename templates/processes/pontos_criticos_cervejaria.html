{% extends 'base.html' %}

{% block title %}Pontos Cr√≠ticos HACCP - {{ cervejaria.name }}{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h2>üéØ Pontos Cr√≠ticos de Controle (CCP)</h2>
        <p style="color: #999; margin-top: 0.5rem;">{{ cervejaria.name }} | Total: {{ total_pontos }} pontos</p>
    </div>
    <div style="display: flex; gap: 1rem;">
        <a href="{% url 'brewery:detail' cervejaria.id %}" class="btn btn-secondary">‚Üê Voltar</a>
        <a href="{% url 'process:dashboard' cervejaria.id %}" class="btn btn-success">üìä Dashboard</a>
    </div>
</div>

<div class="content">
    {% if processos_com_pontos %}
        <div style="display: grid; gap: 2rem;">
            {% for processo, pontos in processos_com_pontos.items %}
            <div class="card" style="border-left: 5px solid #3498db;">
                <h3 style="color: #3498db; margin-top: 0;">{{ processo.nome }}</h3>
                <p style="color: #666; margin: 0.5rem 0; font-size: 0.9rem;">
                    Categoria: <strong>{{ processo.get_categoria_display }}</strong> | 
                    Pontos Cr√≠ticos: <strong>{{ pontos.count }}</strong>
                </p>
                
                <table class="table" style="margin-top: 1rem;">
                    <thead>
                        <tr>
                            <th>Etapa</th>
                            <th>Tipo de Monitoramento</th>
                            <th>Limites</th>
                            <th>Unidade</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ponto in pontos %}
                        <tr>
                            <td><strong>{{ ponto.etapa.nome }}</strong></td>
                            <td>
                                <span style="background: #3498db; color: white; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.85rem;">
                                    {{ ponto.get_tipo_display }}
                                </span>
                            </td>
                            <td>{{ ponto.limite_minimo }} - {{ ponto.limite_maximo }}</td>
                            <td>{{ ponto.unidade }}</td>
                            <td>
                                <div style="display: flex; gap: 0.5rem;">
                                    <a href="#" style="color: #3498db; text-decoration: none; font-weight: bold;" title="Ver detalhes">üìã</a>
                                    <a href="#" style="color: #f39c12; text-decoration: none; font-weight: bold;" title="Editar">‚úèÔ∏è</a>
                                </div>
                            </td>
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td colspan="5">
                                <small style="color: #666;">
                                    <strong>A√ß√£o Preventiva:</strong> {{ ponto.acao_preventiva }}<br>
                                    <strong>A√ß√£o Corretiva:</strong> {{ ponto.acao_corretiva }}
                                </small>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="card" style="text-align: center; padding: 3rem; background: #f0f8ff; border: 2px solid #3498db;">
            <p style="color: #3498db; margin: 0; font-size: 1.1rem;">
                <strong>üéØ Nenhum ponto cr√≠tico definido ainda</strong>
            </p>
            <p style="color: #666; margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                Defina pontos cr√≠ticos de controle (CCP) em seus processos para iniciar o monitoramento HACCP
            </p>
            <a href="{% url 'process:list' cervejaria.id %}" class="btn btn-primary" style="margin-top: 1rem;">
                üìã Acessar Processos
            </a>
        </div>
    {% endif %}

    <!-- Info Box -->
    <div style="margin-top: 2.5rem; background: #f0f8ff; padding: 1.5rem; border-radius: 8px; border-left: 5px solid #3498db;">
        <h4 style="color: #3498db; margin-top: 0;">‚ÑπÔ∏è O que s√£o Pontos Cr√≠ticos de Controle?</h4>
        <p style="color: #666; margin: 0.5rem 0;">
            Pontos Cr√≠ticos de Controle (CCP) s√£o etapas no seu processo onde voc√™ pode aplicar controle para 
            prevenir, eliminar ou reduzir significativamente o risco de ocorr√™ncia de um perigo.
        </p>
        <ul style="color: #666; margin: 1rem 0 0 0;">
            <li>Monitore valores cr√≠ticos (temperatura, pH, press√£o, etc)</li>
            <li>Defina limites m√°ximos e m√≠nimos aceit√°veis</li>
            <li>Documente a√ß√µes preventivas e corretivas</li>
            <li>Mantenha registros de cada medi√ß√£o realizada</li>
        </ul>
    </div>
</div>
{% endblock %}
